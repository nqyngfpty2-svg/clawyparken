{% extends "base.html" %}
{% block content %}
<h2 class="h5">Buchung verwalten</h2>

<div class="alert alert-warning">
  <strong>Wichtig:</strong> Das hier ist dein Buchungslink (Buchungscode). Bitte jetzt speichern.
</div>

<div class="card mb-3">
  <div class="card-body">
    <label class="form-label mb-1">Buchungslink</label>
    <div class="input-group">
      <input id="bookingLink" class="form-control mono" value="{{ request.url }}" readonly />
      <button class="btn btn-outline-primary" type="button" onclick="copyLink()">Kopieren</button>
      <a class="btn btn-outline-secondary" href="/manage/{{ token }}/download">Download</a>
    </div>
    <div id="copyMsg" class="text-success small mt-2" style="display:none">Kopiert.</div>
    <div class="text-muted small mt-2">Tipp: Bookmark setzen oder dir selbst schicken.</div>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <div><strong>Parkplatz:</strong> <span class="mono">{{ b.spot }}</span></div>
    <div><strong>Datum:</strong> <span class="mono">{{ b.day }}</span></div>
    <div><strong>Status:</strong> <span class="mono">{{ b.status }}</span></div>
    <div class="mt-3">
      {% if b.status == 'active' %}
        <form method="post" action="/manage/{{ token }}/cancel" class="row g-2">
          <div class="col-sm-8">
            <input class="form-control form-control-sm" name="reason" placeholder="Optionaler Grund" />
          </div>
          <div class="col-sm-4">
            <button class="btn btn-danger btn-sm w-100" type="submit">Stornieren</button>
          </div>
        </form>
      {% else %}
        <div class="alert alert-secondary mb-0">Diese Buchung ist nicht mehr aktiv.</div>
      {% endif %}
    </div>
  </div>
</div>

<script>
function copyLink(){
  const el = document.getElementById('bookingLink');
  el.focus();
  el.select();
  try {
    document.execCommand('copy');
  } catch (e) {}
  const msg = document.getElementById('copyMsg');
  msg.style.display='block';
  setTimeout(()=>{ msg.style.display='none'; }, 1500);
}
</script>

{% endblock %}
